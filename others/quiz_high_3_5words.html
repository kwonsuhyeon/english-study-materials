<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°ê´€ì‹ ì˜ì–´ ë‹¨ì–´ í€´ì¦ˆ</title>
    <!-- START_USER_EDITABLE_CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 100%;
        }
        
        .title {
            color: #333;
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
        }
        
        .name-input {
            margin-bottom: 30px;
            text-align: center;
        }
        
        .name-input input {
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            width: 100%;
            max-width: 300px;
            margin-bottom: 15px;
        }
        
        .progress-section {
            margin-bottom: 20px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .question-counter {
            font-size: 14px;
            color: #666;
        }
        
        .progress {
            background: #e1e5e9;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .question-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 15px;
            padding: 40px 30px;
            margin: 30px 0;
            color: white;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .question-title {
            font-size: 18px;
            margin-bottom: 20px;
            opacity: 0.9;
        }
        
        .english-word {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .sound-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            color: white;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s;
        }
        
        .sound-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }
        
        .choices-container {
            margin: 30px 0;
        }
        
        .choice {
            display: block;
            width: 100%;
            padding: 15px 20px;
            margin: 10px 0;
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .choice:hover {
            border-color: #4facfe;
            background: #f8f9ff;
        }
        
        .choice.selected {
            border-color: #4facfe;
            background: #e6f3ff;
        }
        
        .choice.correct {
            border-color: #4CAF50;
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .choice.wrong {
            border-color: #f44336;
            background: #ffeaea;
            color: #c62828;
        }
        
        .choice.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .choice-letter {
            font-weight: bold;
            margin-right: 10px;
            color: #666;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .next-btn {
            background: #4facfe;
            color: white;
            width: 100%;
            margin-top: 20px;
        }
        
        .next-btn:hover:not(:disabled) {
            background: #3b9cfe;
            transform: translateY(-2px);
        }
        
        .start-btn, .retry-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            font-size: 18px;
        }
        
        .start-btn:hover, .retry-btn:hover {
            transform: translateY(-2px);
        }
        
        .results-screen {
            text-align: center;
        }
        
        .score {
            font-size: 48px;
            font-weight: bold;
            color: #4facfe;
            margin: 20px 0;
        }
        
        .accuracy {
            font-size: 24px;
            color: #666;
            margin-bottom: 30px;
        }
        
        .results-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 30px 0;
            text-align: left;
        }
        
        .result-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border: 2px solid;
        }
        
        .result-item.correct {
            border-color: #4CAF50;
            background: #e8f5e8;
        }
        
        .result-item.wrong {
            border-color: #f44336;
            background: #ffeaea;
        }
        
        .result-word {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .result-answer {
            font-size: 14px;
            color: #666;
        }
        
        .result-correct-answer {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .result-wrong-answer {
            color: #f44336;
        }
        
        .buttons-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .hidden {
            display: none;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .english-word {
                font-size: 28px;
            }
            
            .choice {
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .buttons-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
    <!-- END_USER_EDITABLE_CSS -->
</head>
<body>
    <!-- START_USER_EDITABLE_HTML -->
    <div class="container">
        <!-- ì‹œì‘ í™”ë©´ -->
        <div id="startScreen">
            <h1 class="title">ê°ê´€ì‹ ì˜ì–´ ë‹¨ì–´ í€´ì¦ˆ</h1>
            <p style="text-align: center; color: #666; margin-bottom: 30px;">
                5ê°œì˜ ë‹¨ì–´ ë¬¸ì œë¥¼ í’€ì–´ë³´ì„¸ìš”!
            </p>
            <div class="name-input">
                <input type="text" id="learnerName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="20">
                <br>
                <button class="btn start-btn" onclick="startQuiz()">í€´ì¦ˆ ì‹œì‘</button>
            </div>
        </div>
        
        <!-- í€´ì¦ˆ í™”ë©´ -->
        <div id="quizScreen" class="hidden">
            <div class="progress-section">
                <div class="progress-info">
                    <span class="question-counter" id="questionCounter">1 / 5</span>
                </div>
                <div class="progress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-title">ë‹¤ìŒ ë‹¨ì–´ì˜ ëœ»ì€?</div>
                <div class="english-word" id="englishWord"></div>
                <button class="sound-btn" onclick="playSound()">ğŸ”Š</button>
            </div>
            
            <div class="choices-container" id="choicesContainer">
                <!-- ì„ íƒì§€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
            
            <button class="btn next-btn" id="nextBtn" onclick="nextQuestion()" disabled>
                ë‹¤ìŒ ë¬¸ì œ
            </button>
        </div>
        
        <!-- ê²°ê³¼ í™”ë©´ -->
        <div id="resultsScreen" class="hidden">
            <div class="results-screen">
                <h2 class="title">í€´ì¦ˆ ì™„ë£Œ!</h2>
                <div class="score" id="finalScore">0 / 0</div>
                <div class="accuracy" id="finalAccuracy">ì •ë‹µë¥ : 0%</div>
                
                <div class="results-list" id="resultsList">
                    <!-- ê²°ê³¼ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
                
                <div class="buttons-container">
                    <button class="btn retry-btn" onclick="restartQuiz()">ë‹¤ì‹œ í’€ê¸°</button>
                </div>
                
                <p style="margin-top: 30px; color: #666; font-size: 14px;">
                    í•™ìŠµ ë¡œê·¸ê°€ ì½˜ì†”ì— ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.
                </p>
            </div>
        </div>
    </div>
    <!-- END_USER_EDITABLE_HTML -->

    <!-- START_CORE_SYSTEM -->
    <!-- í•™ìŠµ ë¡œê·¸ ì‹œìŠ¤í…œ -->
    <script>
        /**
 * í•™ìŠµ ë¡œê·¸ ê¸°ë¡ í†µí•© ëª¨ë“ˆ
 * ëª¨ë“  í•™ìŠµ í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë²”ìš© ë¡œê·¸ ì‹œìŠ¤í…œ
 */

        class LearningLogger {
            constructor(options = {}) {
                this.sheetId = options.sheetId || this.extractSheetId(options.sheetUrl);
                this.webAppUrl = options.webAppUrl || 'https://script.google.com/macros/s/AKfycbx7zlKeokSY6WQdFVNRQuQIjzfNy6GXeUqWRv3k2VkvFp-GgS08PR1-ScbFv_-HLpHtRw/exec';
                this.templateId = options.templateId || 'unknown';
                this.isEnabled = options.isEnabled !== false; // ê¸°ë³¸ê°’ true
                this.offlineStorageKey = `learning_logs_${this.templateId}`;

                // ì„¸ì…˜ ì •ë³´
                this.sessionData = {
                    studentName: '',
                    sessionStartTime: null,
                    totalLearningTime: 0,
                    correctAnswers: 0,
                    wrongAnswers: 0,
                    skippedAnswers: 0,
                    hintsUsed: false,
                    additionalData: {},
                    logTime: null
                };

                // ì˜¤í”„ë¼ì¸ ê°ì§€
                this.isOnline = navigator.onLine;
                this.setupConnectionMonitoring();

                // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ë¡œê·¸ ì €ì¥
                this.setupAutoSave();
            }

            /**
             * êµ¬ê¸€ ì‹œíŠ¸ URLì—ì„œ ì‹œíŠ¸ ID ì¶”ì¶œ
             */
            extractSheetId(url) {
                if (!url) return null;
                const match = url.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
                return match ? match[1] : null;
            }

            /**
             * í•™ìŠµ ì„¸ì…˜ ì‹œì‘
             */
            startSession(studentName, additionalData = {}) {
                this.sessionData.studentName = studentName;
                this.sessionData.sessionStartTime = new Date();
                this.sessionData.additionalData = { ...additionalData };

                console.log(`ğŸ“š í•™ìŠµ ì„¸ì…˜ ì‹œì‘: ${studentName} (${this.templateId})`);
            }

            /**
             * ì •ë‹µ ê¸°ë¡
             */
            recordCorrectAnswer() {
                this.sessionData.correctAnswers++;
            }

            /**
             * ì˜¤ë‹µ ê¸°ë¡
             */
            recordWrongAnswer() {
                this.sessionData.wrongAnswers++;
            }

            /**
             * ìŠ¤í‚µ ê¸°ë¡
             */
            recordSkippedAnswer() {
                this.sessionData.skippedAnswers++;
            }

            /**
             * íŒíŠ¸ ì‚¬ìš© ê¸°ë¡
             */
            recordHintUsed() {
                this.sessionData.hintsUsed = true;
            }

            /**
             * ì¶”ê°€ ë°ì´í„° ì„¤ì •
             */
            setAdditionalData(key, value) {
                this.sessionData.additionalData[key] = value;
            }

            /**
             * í•™ìŠµ ì‹œê°„ ê³„ì‚°
             */
            calculateLearningTime() {
                if (!this.sessionData.sessionStartTime) return 0;
                const endTime = new Date();
                return Math.round((endTime - this.sessionData.sessionStartTime) / 1000); // ì´ˆ ë‹¨ìœ„
            }

            /**
             * ì •ì˜¤ë‹µ ì •ë³´ ìƒì„±
             */
            generateAnswerInfo() {
                const { correctAnswers, wrongAnswers, skippedAnswers } = this.sessionData;
                return `ì •ë‹µ:${correctAnswers}, ì˜¤ë‹µ:${wrongAnswers}, ìŠ¤í‚µ:${skippedAnswers}`;
            }

            /**
             * í•™ìŠµ ì„¸ì…˜ ì¢…ë£Œ ë° ë¡œê·¸ ì €ì¥
             */
            async endSession(additionalSessionData = {}) {
                if (!this.isEnabled) {
                    console.log('ğŸ“ ë¡œê·¸ ê¸°ë¡ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                    return { success: true, message: 'ë¡œê·¸ ê¸°ë¡ ë¹„í™œì„±í™”' };
                }

                if (!this.sessionData.studentName || !this.sessionData.sessionStartTime) {
                    console.warn('âš ï¸ ì„¸ì…˜ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    return { success: false, error: 'ì„¸ì…˜ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.' };
                }

                // ìµœì¢… ë°ì´í„° ì¤€ë¹„
                this.sessionData.totalLearningTime = this.calculateLearningTime();
                this.sessionData.logTime = new Date();
                this.sessionData.additionalData = {
                    ...this.sessionData.additionalData,
                    ...additionalSessionData
                };

                const logData = this.formatLogData();

                try {
                    if (this.isOnline) {
                        // ì˜¨ë¼ì¸ ìƒíƒœ: ì¦‰ì‹œ ì „ì†¡
                        const result = await this.sendToGoogleSheet(logData);

                        // ì„±ê³µ ì‹œ ì˜¤í”„ë¼ì¸ ë¡œê·¸ë„ ì „ì†¡ ì‹œë„
                        if (result.success) {
                            await this.sendOfflineLogs();
                        }

                        return result;
                    } else {
                        // ì˜¤í”„ë¼ì¸ ìƒíƒœ: ë¡œì»¬ ì €ì¥
                        this.saveOfflineLog(logData);
                        return {
                            success: true,
                            message: 'ì˜¤í”„ë¼ì¸ ìƒíƒœì…ë‹ˆë‹¤. ë¡œê·¸ê°€ ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.',
                            isOffline: true
                        };
                    }
                } catch (error) {
                    console.error('âŒ ë¡œê·¸ ì €ì¥ ì‹¤íŒ¨:', error);
                    this.saveOfflineLog(logData);
                    return {
                        success: false,
                        error: error.message,
                        isOffline: true
                    };
                }
            }

            /**
             * ë¡œê·¸ ë°ì´í„° í¬ë§·íŒ… (ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì»¬ëŸ¼ êµ¬ì¡°ì— ë§ì¶¤)
             */
            formatLogData() {
                const totalSeconds = this.sessionData.totalLearningTime;
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                const formattedTime = `${minutes}ë¶„ ${seconds}ì´ˆ`;

                return {
                    ê¸°ëŠ¥ëª…: this.templateId,
                    í•™ìƒì´ë¦„: this.sessionData.studentName,
                    ì ‘ì†ì‹œê°„: this.sessionData.sessionStartTime.toLocaleString('ko-KR'),
                    í•™ìŠµì‹œê°„: formattedTime,
                    ì •ì˜¤ë‹µì •ë³´: this.generateAnswerInfo(),
                    íŒíŠ¸ì‚¬ìš©ì—¬ë¶€: this.sessionData.hintsUsed,
                    ë¶€ê°€ì •ë³´: JSON.stringify(this.sessionData.additionalData),
                    ê¸°ë¡ì‹œê°„: this.sessionData.logTime.toLocaleString('ko-KR')
                };
            }

            /**
             * êµ¬ê¸€ ì‹œíŠ¸ë¡œ ë°ì´í„° ì „ì†¡
             */
            async sendToGoogleSheet(logData) {
                try {
                    if (!this.sheetId) {
                        throw new Error('êµ¬ê¸€ ì‹œíŠ¸ IDê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    }

                    const form = new URLSearchParams();
                    form.append('sheetId', this.sheetId);
                    form.append('menu', 'learning_log');

                    // ë¡œê·¸ ë°ì´í„° ì¶”ê°€
                    Object.entries(logData).forEach(([key, value]) => {
                        form.append(key, value);
                    });

                    console.log('ğŸ“¤ êµ¬ê¸€ ì‹œíŠ¸ë¡œ ë¡œê·¸ ì „ì†¡:', logData);

                    const response = await fetch(this.webAppUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: form.toString()
                    });

                    console.log('âœ… ë¡œê·¸ ì „ì†¡ ì™„ë£Œ');
                    return { success: true, message: 'ë¡œê·¸ê°€ êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.' };

                } catch (error) {
                    console.error('âŒ êµ¬ê¸€ ì‹œíŠ¸ ì „ì†¡ ì‹¤íŒ¨:', error);
                    throw error;
                }
            }

            /**
             * ì˜¤í”„ë¼ì¸ ë¡œê·¸ ì €ì¥
             */
            saveOfflineLog(logData) {
                try {
                    const existingLogs = JSON.parse(localStorage.getItem(this.offlineStorageKey) || '[]');
                    existingLogs.push({
                        ...logData,
                        savedAt: new Date().toISOString(),
                        id: Date.now() + Math.random()
                    });

                    localStorage.setItem(this.offlineStorageKey, JSON.stringify(existingLogs));
                    console.log('ğŸ’¾ ì˜¤í”„ë¼ì¸ ë¡œê·¸ ì €ì¥ë¨:', logData.ê¸°ëŠ¥ëª…);
                } catch (error) {
                    console.error('âŒ ì˜¤í”„ë¼ì¸ ë¡œê·¸ ì €ì¥ ì‹¤íŒ¨:', error);
                }
            }

            /**
             * ì €ì¥ëœ ì˜¤í”„ë¼ì¸ ë¡œê·¸ ì „ì†¡
             */
            async sendOfflineLogs() {
                try {
                    const offlineLogs = JSON.parse(localStorage.getItem(this.offlineStorageKey) || '[]');

                    if (offlineLogs.length === 0) {
                        return { success: true, message: 'ì „ì†¡í•  ì˜¤í”„ë¼ì¸ ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.' };
                    }

                    console.log(`ğŸ“¡ ${offlineLogs.length}ê°œì˜ ì˜¤í”„ë¼ì¸ ë¡œê·¸ ì „ì†¡ ì‹œì‘`);

                    let successCount = 0;
                    for (const log of offlineLogs) {
                        try {
                            await this.sendToGoogleSheet(log);
                            successCount++;
                        } catch (error) {
                            console.error('âŒ ì˜¤í”„ë¼ì¸ ë¡œê·¸ ì „ì†¡ ì‹¤íŒ¨:', error);
                            break; // ì‹¤íŒ¨ ì‹œ ì¤‘ë‹¨
                        }
                    }

                    if (successCount === offlineLogs.length) {
                        // ëª¨ë“  ë¡œê·¸ ì „ì†¡ ì„±ê³µ
                        localStorage.removeItem(this.offlineStorageKey);
                        console.log('âœ… ëª¨ë“  ì˜¤í”„ë¼ì¸ ë¡œê·¸ ì „ì†¡ ì™„ë£Œ');
                        return { success: true, message: `${successCount}ê°œì˜ ì˜¤í”„ë¼ì¸ ë¡œê·¸ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.` };
                    } else {
                        // ì¼ë¶€ë§Œ ì„±ê³µ
                        const remainingLogs = offlineLogs.slice(successCount);
                        localStorage.setItem(this.offlineStorageKey, JSON.stringify(remainingLogs));
                        return {
                            success: false,
                            message: `${successCount}ê°œ ì „ì†¡ë¨, ${remainingLogs.length}ê°œ ë‚¨ìŒ`
                        };
                    }

                } catch (error) {
                    console.error('âŒ ì˜¤í”„ë¼ì¸ ë¡œê·¸ ì „ì†¡ ì˜¤ë¥˜:', error);
                    return { success: false, error: error.message };
                }
            }

            /**
             * ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
             */
            setupConnectionMonitoring() {
                window.addEventListener('online', () => {
                    console.log('ğŸŒ ì˜¨ë¼ì¸ ìƒíƒœë¡œ ì „í™˜');
                    this.isOnline = true;
                    this.sendOfflineLogs(); // ìë™ìœ¼ë¡œ ì˜¤í”„ë¼ì¸ ë¡œê·¸ ì „ì†¡
                });

                window.addEventListener('offline', () => {
                    console.log('ğŸ“µ ì˜¤í”„ë¼ì¸ ìƒíƒœë¡œ ì „í™˜');
                    this.isOnline = false;
                });
            }

            /**
             * í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ìë™ ì €ì¥ ì„¤ì •
             */
            setupAutoSave() {
                window.addEventListener('beforeunload', () => {
                    // ì„¸ì…˜ì´ ì§„í–‰ ì¤‘ì´ë©´ í˜„ì¬ ìƒíƒœë¡œ ë¡œê·¸ ì €ì¥
                    if (this.sessionData.sessionStartTime && !this.sessionData.logTime) {
                        const logData = this.formatLogData();
                        logData.ë¶€ê°€ì •ë³´ = JSON.stringify({
                            ...this.sessionData.additionalData,
                            autoSaved: true,
                            reason: 'page_unload'
                        });
                        this.saveOfflineLog(logData);
                    }
                });
            }

            /**
             * ë¡œê·¸ ê¸°ëŠ¥ í™œì„±í™”/ë¹„í™œì„±í™”
             */
            setEnabled(enabled) {
                this.isEnabled = enabled;
                console.log(`ğŸ“ ë¡œê·¸ ê¸°ë¡ ${enabled ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}`);
            }

            /**
             * ì €ì¥ëœ ì˜¤í”„ë¼ì¸ ë¡œê·¸ ê°œìˆ˜ í™•ì¸
             */
            getOfflineLogCount() {
                try {
                    const logs = JSON.parse(localStorage.getItem(this.offlineStorageKey) || '[]');
                    return logs.length;
                } catch {
                    return 0;
                }
            }

            /**
             * ì„¸ì…˜ ì´ˆê¸°í™”
             */
            resetSession() {
                this.sessionData = {
                    studentName: '',
                    sessionStartTime: null,
                    totalLearningTime: 0,
                    correctAnswers: 0,
                    wrongAnswers: 0,
                    skippedAnswers: 0,
                    hintsUsed: false,
                    additionalData: {},
                    logTime: null
                };
            }
        }

        // ì „ì—­ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
        if (typeof window !== 'undefined') {
            window.LearningLogger = LearningLogger;
        }

        // Node.js í™˜ê²½ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥
        if (typeof module !== 'undefined' && module.exports) {
            module.exports = LearningLogger;
        }


    </script>
    <script>
    // ì „ì—­ ë¡œê±° ì¸ìŠ¤í„´ìŠ¤
    let globalLogger = null;

    /**
    * í•™ìŠµ ë¡œê±° ì´ˆê¸°í™”
    * @param {Object} options - ì„¤ì • ì˜µì…˜
    * @param {string} options.templateId - í…œí”Œë¦¿ ì‹ë³„ì (í•„ìˆ˜)
    * @param {string} options.sheetUrl - êµ¬ê¸€ ì‹œíŠ¸ URL (ì„ íƒ)
    * @param {string} options.sheetId - êµ¬ê¸€ ì‹œíŠ¸ ID (ì„ íƒ)
    * @param {boolean} options.isEnabled - ë¡œê·¸ ê¸°ëŠ¥ í™œì„±í™” ì—¬ë¶€ (ê¸°ë³¸ê°’: true)
    * @param {string} options.webAppUrl - Apps Script Web App URL (ì„ íƒ)
    */
    function initLearningLogger(options = {}) {
    // ê¸°ë³¸ í…œí”Œë¦¿ ID ì„¤ì •
    if (!options.templateId) {
    // HTML íŒŒì¼ëª…ì—ì„œ í…œí”Œë¦¿ ID ì¶”ì¶œ
    const fileName = window.location.pathname.split('/').pop();
    options.templateId = fileName.replace('.html', '').replace('-template', '');
    }

    try {
    globalLogger = new LearningLogger(options);
    console.log(`âœ… í•™ìŠµ ë¡œê±° ì´ˆê¸°í™” ì™„ë£Œ: ${options.templateId}`);

    // ì˜¤í”„ë¼ì¸ ë¡œê·¸ ê°œìˆ˜ í™•ì¸ ë° í‘œì‹œ
    const offlineCount = globalLogger.getOfflineLogCount();
    if (offlineCount > 0) {
    showLoggerStatus(`ğŸ“¦ ì €ì¥ëœ ì˜¤í”„ë¼ì¸ ë¡œê·¸ ${offlineCount}ê°œê°€ ìˆìŠµë‹ˆë‹¤.`, 'info');
    }

    return true;
    } catch (error) {
    console.error('âŒ í•™ìŠµ ë¡œê±° ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
    showLoggerStatus('ë¡œê·¸ ì‹œìŠ¤í…œ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
    return false;
    }
    }

    /**
    * í•™ìŠµ ì„¸ì…˜ ì‹œì‘
    * @param {string} studentName - í•™ìƒ ì´ë¦„
    * @param {Object} additionalData - ì¶”ê°€ ë°ì´í„°
    */
    function startLearning(studentName, additionalData = {}) {
    if (!globalLogger) {
    console.warn('âš ï¸ ë¡œê±°ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
    return false;
    }

    if (!studentName || studentName.trim() === '') {
    showLoggerStatus('í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
    return false;
    }

    globalLogger.startSession(studentName.trim(), additionalData);
    showLoggerStatus(`í•™ìŠµ ì‹œì‘: ${studentName}`, 'success');
    return true;
    }

    /**
    * ë‹µë³€ ê¸°ë¡ (í†µí•© ì¸í„°í˜ì´ìŠ¤)
    * @param {string|boolean} result - 'correct', 'wrong', 'skip' ë˜ëŠ” true/false
    * @param {Object} additionalData - ì¶”ê°€ ë°ì´í„°
    */
    function recordAnswer(result, additionalData = {}) {
    if (!globalLogger) {
    console.warn('âš ï¸ ë¡œê±°ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
    return false;
    }

    // ë¬¸ìì—´ ë˜ëŠ” ë¶ˆë¦°ê°’ ì²˜ë¦¬
    switch(result) {
    case 'correct':
    case true:
    globalLogger.recordCorrectAnswer();
    break;
    case 'wrong':
    case false:
    globalLogger.recordWrongAnswer();
    break;
    case 'skip':
    globalLogger.recordSkippedAnswer();
    break;
    default:
    console.warn('âš ï¸ ì•Œ ìˆ˜ ì—†ëŠ” ë‹µë³€ ê²°ê³¼:', result);
    return false;
    }

    // ì¶”ê°€ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì„¤ì •
    Object.entries(additionalData).forEach(([key, value]) => {
    globalLogger.setAdditionalData(key, value);
    });

    return true;
    }

    /**
    * íŒíŠ¸ ì‚¬ìš© ê¸°ë¡
    */
    function recordHintUsed() {
    if (!globalLogger) {
    console.warn('âš ï¸ ë¡œê±°ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
    return false;
    }

    globalLogger.recordHintUsed();
    return true;
    }

    /**
    * ì¶”ê°€ ë°ì´í„° ì„¤ì •
    * @param {string|Object} key - í‚¤ ë˜ëŠ” ê°ì²´
    * @param {any} value - ê°’ (keyê°€ ë¬¸ìì—´ì¸ ê²½ìš°)
    */
    function setLogData(key, value) {
    if (!globalLogger) {
    console.warn('âš ï¸ ë¡œê±°ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
    return false;
    }

    if (typeof key === 'object') {
    // ê°ì²´ì¸ ê²½ìš° ëª¨ë“  í‚¤-ê°’ ìŒ ì„¤ì •
    Object.entries(key).forEach(([k, v]) => {
    globalLogger.setAdditionalData(k, v);
    });
    } else {
    // ë¬¸ìì—´ì¸ ê²½ìš° ë‹¨ì¼ í‚¤-ê°’ ì„¤ì •
    globalLogger.setAdditionalData(key, value);
    }

    return true;
    }

    /**
    * í•™ìŠµ ì„¸ì…˜ ì¢…ë£Œ ë° ë¡œê·¸ ì €ì¥
    * @param {Object} finalData - ìµœì¢… ë°ì´í„°
    */
    async function endLearning(finalData = {}) {
    if (!globalLogger) {
    console.warn('âš ï¸ ë¡œê±°ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
    return { success: false, error: 'ë¡œê±°ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.' };
    }

    showLoggerStatus('í•™ìŠµ ê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” ì¤‘...', 'info');

    try {
    const result = await globalLogger.endSession(finalData);

    if (result.success) {
    if (result.isOffline) {
    showLoggerStatus('ì˜¤í”„ë¼ì¸ ìƒíƒœì…ë‹ˆë‹¤. ì˜¨ë¼ì¸ ë³µê·€ ì‹œ ìë™ ì „ì†¡ë©ë‹ˆë‹¤.', 'warning');
    } else {
    showLoggerStatus('í•™ìŠµ ê²°ê³¼ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
    }
    } else {
    showLoggerStatus(`ì €ì¥ ì‹¤íŒ¨: ${result.error}`, 'error');
    }

    return result;
    } catch (error) {
    console.error('âŒ í•™ìŠµ ì¢…ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
    showLoggerStatus('í•™ìŠµ ê²°ê³¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
    return { success: false, error: error.message };
    }
    }

    /**
    * ë¡œê·¸ ê¸°ëŠ¥ í™œì„±í™”/ë¹„í™œì„±í™”
    * @param {boolean} enabled - í™œì„±í™” ì—¬ë¶€
    */
    function setLoggingEnabled(enabled) {
    if (globalLogger) {
    globalLogger.setEnabled(enabled);
    showLoggerStatus(`ë¡œê·¸ ê¸°ë¡ì´ ${enabled ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
    }
    }

    /**
    * ì˜¤í”„ë¼ì¸ ë¡œê·¸ ìˆ˜ë™ ì „ì†¡
    */
    async function sendOfflineLogs() {
    if (!globalLogger) {
    console.warn('âš ï¸ ë¡œê±°ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
    return { success: false, error: 'ë¡œê±°ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.' };
    }

    showLoggerStatus('ì˜¤í”„ë¼ì¸ ë¡œê·¸ë¥¼ ì „ì†¡í•˜ëŠ” ì¤‘...', 'info');

    try {
    const result = await globalLogger.sendOfflineLogs();

    if (result.success) {
    showLoggerStatus(result.message, 'success');
    } else {
    showLoggerStatus(`ì „ì†¡ ì‹¤íŒ¨: ${result.message}`, 'error');
    }

    return result;
    } catch (error) {
    console.error('âŒ ì˜¤í”„ë¼ì¸ ë¡œê·¸ ì „ì†¡ ì˜¤ë¥˜:', error);
    showLoggerStatus('ì˜¤í”„ë¼ì¸ ë¡œê·¸ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
    return { success: false, error: error.message };
    }
    }

    /**
    * ë¡œê±° ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
    * @param {string} message - ë©”ì‹œì§€
    * @param {string} type - íƒ€ì… ('success', 'error', 'warning', 'info')
    */
    function showLoggerStatus(message, type = 'info') {
    console.log(`ğŸ“ [Logger] ${message}`);

    // ê¸°ì¡´ ìƒíƒœ ìš”ì†Œê°€ ìˆëŠ”ì§€ í™•ì¸
    let statusElement = document.getElementById('logger-status');

    if (!statusElement) {
    // ìƒíƒœ í‘œì‹œ ìš”ì†Œ ìƒì„±
    statusElement = document.createElement('div');
    statusElement.id = 'logger-status';
    statusElement.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 16px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    max-width: 350px;
    z-index: 9999;
    opacity: 0;
    transition: all 0.3s ease;
    pointer-events: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    `;
    document.body.appendChild(statusElement);
    }

    // íƒ€ì…ë³„ ìŠ¤íƒ€ì¼ ì„¤ì •
    const styles = {
    success: 'background: #10B981; color: white;',
    error: 'background: #EF4444; color: white;',
    warning: 'background: #F59E0B; color: white;',
    info: 'background: #3B82F6; color: white;'
    };

    statusElement.style.cssText += styles[type] || styles.info;
    statusElement.textContent = message;
    statusElement.style.opacity = '1';

    // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
    setTimeout(() => {
    statusElement.style.opacity = '0';
    }, 3000);
    }

    /**
    * ê°„í¸í•œ ì…‹ì—… í•¨ìˆ˜ - ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì‹œì‘
    * @param {string} templateId - í…œí”Œë¦¿ ID
    * @param {string} sheetUrl - êµ¬ê¸€ ì‹œíŠ¸ URL (ì„ íƒ)
    */
    function quickSetupLogger(templateId, sheetUrl = null) {
    const options = { templateId };
    if (sheetUrl) options.sheetUrl = sheetUrl;

    return initLearningLogger(options);
    }

    /**
    * HTML í¼ì—ì„œ ìë™ìœ¼ë¡œ í•™ìŠµ ì‹œì‘
    * @param {string} nameInputId - ì´ë¦„ ì…ë ¥ í•„ë“œ ID
    * @param {Object} additionalData - ì¶”ê°€ ë°ì´í„°
    */
    function startLearningFromForm(nameInputId = 'studentName', additionalData = {}) {
    const nameInput = document.getElementById(nameInputId);
    if (!nameInput) {
    showLoggerStatus(`ì´ë¦„ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${nameInputId}`, 'error');
    return false;
    }

    const studentName = nameInput.value.trim();
    return startLearning(studentName, additionalData);
    }

    /**
    * í˜„ì¬ í•™ìŠµ ìƒíƒœ í™•ì¸
    */
    function getLearningStatus() {
    if (!globalLogger) {
    return { initialized: false };
    }

    return {
    initialized: true,
    sessionActive: !!globalLogger.sessionData.sessionStartTime,
    studentName: globalLogger.sessionData.studentName,
    correctAnswers: globalLogger.sessionData.correctAnswers,
    wrongAnswers: globalLogger.sessionData.wrongAnswers,
    skippedAnswers: globalLogger.sessionData.skippedAnswers,
    hintsUsed: globalLogger.sessionData.hintsUsed,
    offlineLogCount: globalLogger.getOfflineLogCount(),
    isOnline: globalLogger.isOnline
    };
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì´ˆê¸°í™” (ì„ íƒì )
    if (typeof window !== 'undefined') {
    // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
    window.initLearningLogger = initLearningLogger;
    window.startLearning = startLearning;
    window.recordAnswer = recordAnswer;
    window.recordHintUsed = recordHintUsed;
    window.setLogData = setLogData;
    window.endLearning = endLearning;
    window.setLoggingEnabled = setLoggingEnabled;
    window.sendOfflineLogs = sendOfflineLogs;
    window.showLoggerStatus = showLoggerStatus;
    window.quickSetupLogger = quickSetupLogger;
    window.startLearningFromForm = startLearningFromForm;
    window.getLearningStatus = getLearningStatus;
    }

    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    const LoggerUtils = {
    // ì‹œê°„ í¬ë§·íŒ…
    formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    },

    // ì •ë‹µë¥  ê³„ì‚°
    calculateAccuracy(correct, total) {
    if (total === 0) return 0;
    return Math.round((correct / total) * 100);
    },

    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬
    clearOfflineLogs() {
    if (globalLogger) {
    localStorage.removeItem(globalLogger.offlineStorageKey);
    showLoggerStatus('ì˜¤í”„ë¼ì¸ ë¡œê·¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
    }
    }
    };

    if (typeof window !== 'undefined') {
    window.LoggerUtils = LoggerUtils;
    }
    </script>
    <!-- END_CORE_SYSTEM -->
    
    <!-- START_USER_EDITABLE_DATA -->
    <script>
        const quizData = [{"english":"january","correctAnswer":"1ì›”","choices":["1ì›”","ë§ˆë‹´","ë¯¸í„°","íŒŒìš´ë“œ"]},{"english":"quid","correctAnswer":"íŒŒìš´ë“œ","choices":["ê°¤ëŸ°","íŒŒìš´ë“œ","ë¯¸í„°","1ì›”"]},{"english":"madam","correctAnswer":"ë§ˆë‹´","choices":["ë¯¸í„°","ë§ˆë‹´","ê°¤ëŸ°","íŒŒìš´ë“œ"]},{"english":"gallon","correctAnswer":"ê°¤ëŸ°","choices":["1ì›”","íŒŒìš´ë“œ","ë§ˆë‹´","ê°¤ëŸ°"]},{"english":"meter","correctAnswer":"ë¯¸í„°","choices":["ë¯¸í„°","1ì›”","íŒŒìš´ë“œ","ê°¤ëŸ°"]}];
    </script>
    <!-- END_USER_EDITABLE_DATA -->

    <!-- START_USER_EDITABLE_LOGIC -->
    <script>
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = [];
        let learnerName = '';
        let startTime = new Date();
        let selectedChoice = null;
        let currentSchoolLevel = '';
        let currentTeacherEmail = '';
        
        // ë¡œê±° ì¸ìŠ¤í„´ìŠ¤ ì €ì¥ìš© ë³€ìˆ˜
        let logger = null;
        
        function startQuiz() {
            learnerName = document.getElementById('learnerName').value.trim();
            
            if (!learnerName) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // í…œí”Œë¦¿ ë³€ìˆ˜ì—ì„œ í•™êµê¸‰ê³¼ í•™ë…„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const schoolLevel = 'elementary';
            const grade = '3';
            
            // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
            window.currentSchoolLevel = schoolLevel;
            window.currentGrade = grade;
            
            // í…œí”Œë¦¿ ë³€ìˆ˜ì—ì„œ ì‹œíŠ¸ URL ê°€ì ¸ì˜¤ê¸°
            const sheetUrl = 'https://docs.google.com/spreadsheets/d/1cdlLcI6MeTlPDUbyjoZ5KLXPQGgZ6PIfkgWiXJNYlqc/edit?usp=sharing';
            
            // ë¡œê±° ì´ˆê¸°í™” (ì‹œíŠ¸ URLì´ ìˆëŠ” ê²½ìš°ì—ë§Œ)
            const isLoggingEnabled = sheetUrl && sheetUrl.length > 0 && !sheetUrl.includes('{{');
            if (isLoggingEnabled) {
                try {
                    initLearningLogger({
                        templateId: 'multiple-choice-quiz',
                        sheetUrl: sheetUrl,
                        isEnabled: true
                    });
                    
                    // ë¡œê·¸ ì‹œìŠ¤í…œì— í•™ìŠµ ì‹œì‘ ê¸°ë¡
                    window.startLearning(learnerName, {
                        totalQuestions: quizData.length,
                        studyType: 'multiple-choice-quiz',
                        schoolLevel: schoolLevel,
                        grade: grade
                    });
                } catch (error) {
                    console.warn('ë¡œê·¸ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                }
            }
            
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = [];
            startTime = new Date();
            
            showQuestion();
        }
        
        function showQuestion() {
            if (currentQuestionIndex >= quizData.length) {
                showResults();
                return;
            }
            
            const question = quizData[currentQuestionIndex];
            selectedChoice = null;
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            const progress = ((currentQuestionIndex + 1) / quizData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('questionCounter').textContent = `${currentQuestionIndex + 1} / ${quizData.length}`;
            
            // ì˜ì–´ ë‹¨ì–´ í‘œì‹œ
            document.getElementById('englishWord').textContent = question.english;
            
            // ì„ íƒì§€ ìƒì„±
            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.innerHTML = '';
            
            question.choices.forEach((choice, index) => {
                const choiceButton = document.createElement('button');
                choiceButton.className = 'choice';
                choiceButton.innerHTML = `<span class="choice-letter">${String.fromCharCode(65 + index)}.</span>${choice}`;
                choiceButton.onclick = () => selectChoice(choiceButton, choice);
                choicesContainer.appendChild(choiceButton);
            });
            
            // ë‹¤ìŒ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.getElementById('nextBtn').disabled = true;
            const nextBtn = document.getElementById('nextBtn');
            nextBtn.textContent = currentQuestionIndex < quizData.length - 1 ? 'ë‹¤ìŒ ë¬¸ì œ' : 'ê²°ê³¼ ë³´ê¸°';
        }
        
        function selectChoice(choiceElement, selectedAnswer) {
            if (selectedChoice !== null) return; // ì´ë¯¸ ì„ íƒí–ˆìœ¼ë©´ ë¬´ì‹œ
            
            selectedChoice = selectedAnswer;
            const question = quizData[currentQuestionIndex];
            const isCorrect = selectedAnswer === question.correctAnswer;
            
            // ëª¨ë“  ì„ íƒì§€ ë¹„í™œì„±í™”
            const choices = document.querySelectorAll('.choice');
            choices.forEach(choice => {
                choice.classList.add('disabled');
                const choiceText = choice.textContent.substring(2); // "A. " ë¶€ë¶„ ì œê±°
                
                if (choiceText === question.correctAnswer) {
                    choice.classList.add('correct');
                } else if (choiceText === selectedAnswer && !isCorrect) {
                    choice.classList.add('wrong');
                }
            });
            
            // ë¡œê·¸ ì‹œìŠ¤í…œì— ë‹µë³€ ê¸°ë¡ (ë¡œê·¸ê°€ í™œì„±í™”ëœ ê²½ìš°ë§Œ)
            if (typeof recordAnswer === 'function') {
                try {
                    recordAnswer(isCorrect ? 'correct' : 'wrong', {
                        questionIndex: currentQuestionIndex,
                        english: question.english,
                        correctAnswer: question.correctAnswer,
                        selectedAnswer: selectedAnswer,
                        isCorrect: isCorrect
                    });
                } catch (error) {
                    console.warn('ë¡œê·¸ ê¸°ë¡ ì‹¤íŒ¨:', error);
                }
            }
            
            // ë‹µì•ˆ ê¸°ë¡
            userAnswers.push({
                question: question.english,
                selectedAnswer: selectedAnswer,
                correctAnswer: question.correctAnswer,
                isCorrect: isCorrect
            });
            
            if (isCorrect) {
                score++;
            }
            
            // ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('nextBtn').disabled = false;
        }
        
        function nextQuestion() {
            currentQuestionIndex++;
            showQuestion();
        }
        
        function playSound() {
            const question = quizData[currentQuestionIndex];
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(question.english);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }
        
        function showResults() {
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            
            const totalQuestions = quizData.length;
            const accuracy = Math.round((score / totalQuestions) * 100);
            
            document.getElementById('finalScore').textContent = `${score} / ${totalQuestions}`;
            document.getElementById('finalAccuracy').textContent = `ì •ë‹µë¥ : ${accuracy}%`;
            
            // ê²°ê³¼ ëª©ë¡ ìƒì„±
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';
            
            userAnswers.forEach((answer, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = `result-item ${answer.isCorrect ? 'correct' : 'wrong'}`;
                
                let answerText = '';
                if (answer.isCorrect) {
                    answerText = `<div class="result-answer">ì„ íƒí•œ ë‹µ: <span class="result-correct-answer">${answer.selectedAnswer}</span></div>`;
                } else {
                    answerText = `
                        <div class="result-answer">ì„ íƒí•œ ë‹µ: <span class="result-wrong-answer">${answer.selectedAnswer}</span></div>
                        <div class="result-answer">ì •ë‹µ: <span class="result-correct-answer">${answer.correctAnswer}</span></div>
                    `;
                }
                
                resultItem.innerHTML = `
                    <div class="result-word">${answer.question}</div>
                    ${answerText}
                `;
                
                resultsList.appendChild(resultItem);
            });
            
            // ìƒˆë¡œìš´ ë¡œê·¸ ì‹œìŠ¤í…œìœ¼ë¡œ í•™ìŠµ ì™„ë£Œ ê¸°ë¡
            logLearningData();
        }
        
        async function logLearningData() {
            const totalQuestions = quizData.length;
            const accuracy = Math.round((score / totalQuestions) * 100);
            
            // ìƒˆë¡œìš´ ë¡œê·¸ ì‹œìŠ¤í…œìœ¼ë¡œ í•™ìŠµ ì™„ë£Œ ê¸°ë¡ (ë¡œê·¸ê°€ í™œì„±í™”ëœ ê²½ìš°ë§Œ)
            if (typeof endLearning === 'function') {
                try {
                    const logResult = await endLearning({
                        finalAccuracy: accuracy,
                        finalScore: `${score}/${totalQuestions}`,
                        schoolLevel: currentSchoolLevel,
                        teacherEmail: currentTeacherEmail,
                        detailedAnswers: JSON.stringify(userAnswers),
                        studyMethod: 'multiple-choice-quiz'
                    });
                    
                    // ë¡œê·¸ ì €ì¥ ê²°ê³¼ í‘œì‹œ
                    if (logResult.success) {
                        if (logResult.isOffline) {
                            console.log('ğŸ“± ì˜¤í”„ë¼ì¸ ìƒíƒœì…ë‹ˆë‹¤. ì˜¨ë¼ì¸ ë³µê·€ ì‹œ ìë™ ì „ì†¡ë©ë‹ˆë‹¤.');
                        } else {
                            console.log('âœ… í•™ìŠµ ê²°ê³¼ê°€ êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        }
                    } else {
                        console.error('âŒ ì €ì¥ ì‹¤íŒ¨:', logResult.error);
                    }
                } catch (error) {
                    console.warn('ë¡œê·¸ ì¢…ë£Œ ì‹¤íŒ¨:', error);
                }
            } else {
                console.log('ğŸ“ ë¡œê·¸ ì‹œìŠ¤í…œì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ê¸°ì¡´ saveToGoogleSheet í•¨ìˆ˜ë“¤ì€ ìƒˆë¡œìš´ í†µí•© ë¡œê·¸ ì‹œìŠ¤í…œìœ¼ë¡œ ëŒ€ì²´ë¨
        
        function restartQuiz() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
            
            // ì´ˆê¸°í™”
            document.getElementById('learnerName').value = '';
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = [];
            selectedChoice = null;
        }
        
        // ì—”í„°í‚¤ë¡œ í€´ì¦ˆ ì‹œì‘
        document.getElementById('learnerName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                startQuiz();
            }
        });
    </script>
    <!-- END_USER_EDITABLE_LOGIC -->
</body>
</html>